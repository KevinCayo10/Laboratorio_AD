"use strict";(self.webpackChunkappGSV=self.webpackChunkappGSV||[]).push([[990],{8990:(Y,c,s)=>{s.r(c),s.d(c,{VentasModule:()=>M});var d=s(6895),m=s(1667),g=s(9849),p=s(5226),f=s.n(p),o=s(4650),v=s(6099),h=s(3793),C=s(1434),b=s(6822),Z=s(9828),T=s(7284),V=s(4841),U=s(6846),i=s(433);function F(e,a){if(1&e&&(o.TgZ(0,"option",13),o._uU(1),o.qZA()),2&e){const t=a.$implicit;o.Q6J("value",t.producto),o.xp6(1),o.Oqu(t.producto)}}let R=(()=>{class e{constructor(){this.formularioEnviado=new o.vpe,this.formularioCerrado=new o.vpe,this.maximo=0}ngOnInit(){console.log(this.data),this.cargarFormulario()}cargarFormulario(){this.formulario=new i.cw({producto:new i.NI(this.data?.producto,i.kI.required),cantidad:new i.NI(this.data?.stock,i.kI.required)})}actualizarMaximo(){const t=this.formulario.get("producto")?.value;t?(this.registroSeleccionado=this.data.find(r=>r.producto==t),this.registroSeleccionado&&(console.log(this.registroSeleccionado.stock),this.maximo=this.registroSeleccionado.stock)):this.maximo=0}grabar(){if(this.formulario.valid){const t={...this.formulario.value,_id:this.registroSeleccionado._id,stock:this.registroSeleccionado.stock,precio:this.registroSeleccionado.precio,descripcion:this.registroSeleccionado.descripcion};console.log(t),this.formularioEnviado.emit(t),this.formulario.reset()}}cerrarFormulario(){this.formularioCerrado.emit()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Xpm({type:e,selectors:[["gsv-form"]],inputs:{data:"data"},outputs:{formularioEnviado:"formularioEnviado",formularioCerrado:"formularioCerrado"},decls:18,vars:4,consts:[[1,"container","col-md-10"],[1,"card","custom-card"],[1,"card-body"],[1,"form-container","d-flex","flex-row",3,"formGroup","ngSubmit"],[1,"form-group","flex-grow-1","me-2"],["for","producto"],["id","producto","formControlName","producto",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","cantidad"],["type","number","id","cantidad","formControlName","cantidad","min","1",1,"form-control",3,"max"],["type","submit",1,"btn","btn-primary","m-2",3,"disabled"],[1,"fas","fa-plus"],[3,"value"]],template:function(t,r){1&t&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),o.NdJ("ngSubmit",function(){return r.grabar()}),o.TgZ(4,"div",4)(5,"label",5),o._uU(6,"Producto"),o.qZA(),o.TgZ(7,"select",6),o.NdJ("change",function(){return r.actualizarMaximo()}),o.TgZ(8,"option",7),o._uU(9,"Seleccionar producto"),o.qZA(),o.YNc(10,F,2,2,"option",8),o.qZA()(),o.TgZ(11,"div",4)(12,"label",9),o._uU(13,"Cantidad"),o.qZA(),o._UZ(14,"input",10),o.qZA(),o.TgZ(15,"button",11),o._UZ(16,"i",12),o._uU(17," A\xf1adir "),o.qZA()()()()()),2&t&&(o.xp6(3),o.Q6J("formGroup",r.formulario),o.xp6(7),o.Q6J("ngForOf",r.data),o.xp6(4),o.Q6J("max",r.maximo),o.xp6(1),o.Q6J("disabled",r.formulario.invalid))},dependencies:[d.sg,i._Y,i.YN,i.Kr,i.Fj,i.wV,i.EJ,i.JJ,i.JL,i.qQ,i.Fd,i.sg,i.u]}),e})();var u=s(7155);function _(e,a){if(1&e&&(o.TgZ(0,"th"),o._uU(1),o.qZA()),2&e){const t=a.$implicit;o.xp6(1),o.Oqu(t.title)}}function S(e,a){if(1&e&&(o.TgZ(0,"td"),o._uU(1),o.qZA()),2&e){const t=a.$implicit,r=o.oxw().$implicit;o.xp6(1),o.Oqu(r[t.field])}}function J(e,a){if(1&e&&(o.TgZ(0,"tr"),o.YNc(1,S,2,1,"td",2),o.qZA()),2&e){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.metaDataColumns)}}let P=(()=>{class e{constructor(){this.onClick=new o.vpe,this.columns=[]}ngOnChanges(t){t.metaDataColumns&&(this.columns=this.metaDataColumns.map(r=>r.field))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Xpm({type:e,selectors:[["gsv-sale-table"]],contentQueries:function(t,r,n){if(1&t&&o.Suo(n,u.w1,5),2&t){let l;o.iGM(l=o.CRH())&&(r.columnsDef=l)}},viewQuery:function(t,r){if(1&t&&o.Gf(u.BZ,7),2&t){let n;o.iGM(n=o.CRH())&&(r.table=n.first)}},inputs:{data:"data",metaDataColumns:"metaDataColumns",title:"title"},outputs:{onClick:"onClick"},features:[o.TTD],decls:7,vars:2,consts:[[1,"container"],[1,"table","table-striped"],[4,"ngFor","ngForOf"]],template:function(t,r){1&t&&(o.TgZ(0,"div",0)(1,"table",1)(2,"thead")(3,"tr"),o.YNc(4,_,2,1,"th",2),o.qZA()(),o.TgZ(5,"tbody"),o.YNc(6,J,2,1,"tr",2),o.qZA()()()),2&t&&(o.xp6(4),o.Q6J("ngForOf",r.metaDataColumns),o.xp6(2),o.Q6J("ngForOf",r.data))},dependencies:[d.sg]}),e})();function A(e,a){if(1&e&&(o.TgZ(0,"option",14),o._uU(1),o.qZA()),2&e){const t=a.$implicit;o.Q6J("value",t.nombresCompletos),o.xp6(1),o.hij("",t.nombresCompletos," ")}}function Q(e,a){if(1&e&&(o.TgZ(0,"option",14),o._uU(1),o.qZA()),2&e){const t=a.$implicit;o.Q6J("value",t.nombresCompletos),o.xp6(1),o.hij("",t.nombresCompletos," ")}}let x=(()=>{class e{constructor(){this.validarEnviado=!1,this.formularioEnviado=new o.vpe,this.formularioCerrado=new o.vpe}ngOnInit(){this.cargarFormulario(),this.validarEnviado=!1,console.log(this.validarGenerarVenta)}cargarFormulario(){this.formulario=new i.cw({cliente:new i.NI(this.dataCliente?.nombresCompletos,i.kI.required),vendedor:new i.NI(this.dataVendedor?.nombresCompletos,i.kI.required)})}grabar(){if(this.formulario.valid){const t=this.formulario.value;console.log(t),this.validarEnviado=!0,this.formularioEnviado.emit(t),this.formulario.disable()}}cerrarFormulario(){this.formularioCerrado.emit()}limpiarFormulario(){this.formulario.reset(),this.validarEnviado=!1,this.formulario.enable()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Xpm({type:e,selectors:[["gsv-form-user"]],inputs:{dataCliente:"dataCliente",dataVendedor:"dataVendedor",validarGenerarVenta:"validarGenerarVenta"},outputs:{formularioEnviado:"formularioEnviado",formularioCerrado:"formularioCerrado"},decls:22,vars:4,consts:[[1,"container","col-md-10"],[1,"card","custom-card"],[1,"card-body"],[1,"form-container","d-flex","flex-row","align-items-end",3,"formGroup","ngSubmit"],[1,"form-group","flex-grow-1","me-2"],["for","cliente"],["id","cliente","formControlName","cliente",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","vendedor"],["id","vendedor","formControlName","vendedor",1,"form-control"],[1,"d-flex","align-items-end"],["type","submit",1,"btn","btn-primary","m-2",3,"disabled"],[1,"fas","fa-save"],[3,"value"]],template:function(t,r){1&t&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),o.NdJ("ngSubmit",function(){return r.grabar()}),o.TgZ(4,"div",4)(5,"label",5),o._uU(6,"Cliente"),o.qZA(),o.TgZ(7,"select",6)(8,"option",7),o._uU(9,"Seleccionar cliente"),o.qZA(),o.YNc(10,A,2,2,"option",8),o.qZA()(),o.TgZ(11,"div",4)(12,"label",9),o._uU(13,"Vendedor"),o.qZA(),o.TgZ(14,"select",10)(15,"option",7),o._uU(16,"Seleccionar Vendedor"),o.qZA(),o.YNc(17,Q,2,2,"option",8),o.qZA()(),o.TgZ(18,"div",11)(19,"button",12),o._UZ(20,"i",13),o._uU(21," Guardar "),o.qZA()()()()()()),2&t&&(o.xp6(3),o.Q6J("formGroup",r.formulario),o.xp6(7),o.Q6J("ngForOf",r.dataCliente),o.xp6(7),o.Q6J("ngForOf",r.dataVendedor),o.xp6(2),o.Q6J("disabled",r.formulario.invalid||r.validarEnviado))},dependencies:[d.sg,i._Y,i.YN,i.Kr,i.EJ,i.JJ,i.JL,i.sg,i.u]}),e})();const y=["formUserRef"];function E(e,a){if(1&e){const t=o.EpF();o.TgZ(0,"gsv-form",9),o.NdJ("formularioEnviado",function(n){o.CHM(t);const l=o.oxw();return o.KtG(l.grabarFormulario(n))}),o.qZA()}if(2&e){const t=o.oxw();o.Q6J("data",t.registrosProducto)}}const N=[{path:"",component:(()=>{class e{constructor(t,r,n,l){this.productoService=t,this.clienteService=r,this.vendedorService=n,this.cajaService=l,this.registrosProducto=[],this.registrosClientes=[],this.registrosVendedores=[],this.registros=[],this.metaDataColumns=[{field:"producto",title:"PRODUCTO"},{field:"cantidad",title:"CANTIDAD"},{field:"subtotal",title:"SUBTOTAL"}],this.data=[],this.totalRegistros=this.data.length,this.cargarRegistroProducto(),this.cargarRegistroVenta(),this.cargarRegistroVendedor(),this.cargarRegistroCliente(),this.validarRegistroUser=!1,this.validarRegistroProduct=!1}cargarRegistroVendedor(){this.vendedorService.cargarVendedores().subscribe(t=>{this.registrosVendedores=t})}cargarRegistroCliente(){this.clienteService.cargarClientes().subscribe(t=>{this.registrosClientes=t})}cargarRegistroProducto(){this.productoService.cargarProductos().subscribe(t=>{this.registrosProducto=t,console.log("Registro producto",this.registrosProducto)})}cargarRegistroVenta(){this.data=this.registros,this.totalRegistros=this.data.length,this.validarRegistroProduct=this.totalRegistros>0,this.changePage(0)}changePage(t){const r=g.N.PAGE_SIZE,n=r*t;this.data=this.registros.slice(n,n+r)}grabarFormulario(t){const r={producto:t.producto,cantidad:t.cantidad,subtotal:t.precio*t.cantidad},n={producto:t.producto,descripcion:t.descripcion,stock:t.stock-t.cantidad,precio:t.precio};console.log(r),this.actualizarRegistroProducto(t._id,n),this.registros.push(r),this.cargarRegistroVenta()}actualizarRegistroProducto(t,r){this.productoService.actualizarProducto(t,r).subscribe(()=>{this.cargarRegistroProducto()})}grabarUserRegister(t){this.registroUsuarioVenta=t,this.registroUsuarioVenta&&(this.validarRegistroUser=!0,console.log(this.registroUsuarioVenta))}cambiarEstadoDelValidarRegistro(){this.validarRegistroUser=!1,console.log("entro")}setVenta(){this.registrarVenta(this.registroUsuarioVenta,this.registros)}registrarVenta(t,r){let n=this.registros.reduce((w,q)=>w+q.subtotal,0);console.log(n);const l={cliente:this.registroUsuarioVenta.cliente,vendedor:this.registroUsuarioVenta.vendedor,total:n};this.cajaService.registrarCaja(l).subscribe(()=>{this.registros=[],this.cargarRegistroVenta(),this.mostrarMensajeVenta(l),this.cargarRegistroCliente(),this.cargarRegistroVendedor(),this.limpiarFormulario(),this.validarRegistroUser=!1})}limpiarFormulario(){this.formUserRef&&this.formUserRef.limpiarFormulario()}mostrarMensajeVenta(t){f().fire({icon:"info",title:"Detalles de la transacci\xf3n",html:`\n      <strong>Cliente:</strong> ${t.cliente}<br>\n    <strong>Vendedor:</strong> ${t.vendedor}<br>\n    <strong>Monto total:</strong> ${t.total}\n      <p>Revisar en el modulo de caja</p>\n    `,confirmButtonText:"Aceptar"})}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(v.U),o.Y36(h.$),o.Y36(C.o),o.Y36(b.Z))},e.\u0275cmp=o.Xpm({type:e,selectors:[["gsv-page-list"]],viewQuery:function(t,r){if(1&t&&o.Gf(y,5),2&t){let n;o.iGM(n=o.CRH())&&(r.formUserRef=n.first)}},decls:14,vars:8,consts:[[1,"container"],[1,"form"],[3,"dataCliente","dataVendedor","validarGenerarVenta","formularioEnviado"],["formUserRef",""],[3,"data","formularioEnviado",4,"ngIf"],[3,"data","metaDataColumns"],[3,"length","onChangePage"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-shopping-cart"],[3,"data","formularioEnviado"]],template:function(t,r){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"gsv-title"),o.TgZ(2,"div",1)(3,"gsv-form-user",2,3),o.NdJ("formularioEnviado",function(l){return r.grabarUserRegister(l)}),o.qZA()(),o.TgZ(5,"div",1),o.YNc(6,E,1,1,"gsv-form",4),o.qZA()(),o.TgZ(7,"gsv-container")(8,"perfect-scrollbar"),o._UZ(9,"gsv-sale-table",5),o.qZA(),o.TgZ(10,"gsv-paginator",6),o.NdJ("onChangePage",function(l){return r.changePage(l)}),o.qZA(),o.TgZ(11,"button",7),o.NdJ("click",function(){return r.setVenta()}),o._UZ(12,"i",8),o._uU(13," Generar Venta "),o.qZA()()),2&t&&(o.xp6(3),o.Q6J("dataCliente",r.registrosClientes)("dataVendedor",r.registrosVendedores)("validarGenerarVenta",r.validarRegistroProduct),o.xp6(3),o.Q6J("ngIf",r.validarRegistroUser),o.xp6(3),o.Q6J("data",r.data)("metaDataColumns",r.metaDataColumns),o.xp6(1),o.Q6J("length",r.totalRegistros),o.xp6(1),o.Q6J("disabled",!r.validarRegistroProduct))},dependencies:[d.O5,Z.r,T.e,V.Vv,U.J,R,P,x],styles:["gsv-container[_ngcontent-%COMP%]{text-align:center}.container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{margin:.3em 0}"]}),e})()}];let O=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[m.Bz.forChild(N),m.Bz]}),e})();var G=s(8366);let M=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[d.ez,O,G.m]}),e})()}}]);